<!DOCTYPE html>
<html data-ng-app="app">
<head lang="en">
    <meta charset="UTF-8">
    <title>Front-end Guide front-end-guide</title>
    <!--[if lt IE 9]>
    <script>
        (function (d, a) { var l = a.length; while(l--){ d.createElement(a[l]); } }(document,
        ['HEADER', 'NAV', 'SECTION', 'FOOTER', 'ARTICLE', 'MAIN', 'FIGCAPTION', 'FIGURE', 'ASIDE']));
    </script>
    <![endif]-->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/prism/0.0.1/prism.min.css">
    <link rel="stylesheet" href="views/_guide-viewer/guide-viewer.css">
</head>
<body class="viewer" data-ng-controller="ViewerController as viewer">


<header class="viewer-header" data-viewer-header data-ng-class="{ 'is-small': viewer.isCompact }">
	<img alt="De Voorhoede" class="viewer-logo"
         data-ng-src="{{ viewer.rootPath }}assets/views/_guide-viewer/voorhoede-logo.svg">
	<nav class="viewer-module-selector">
		<div class="viewer-header-select-wrapper">
			  <span class="viewer-model-type-icon" data-ng-class="{
                'viewer-icon-component' : viewer.module.type == 'component',
                'viewer-icon-view' : viewer.module.type == 'view',
            }"></span>
			<select id="viewer-module" class="viewer-header-select" data-ng-model="viewer.module"
					data-ng-options="module.name group by module.type for (id, module) in viewer.modules"></select>

		</div>
        <button class="viewer-button viewer-icon-label" data-ng-class="{ 'is-active': viewer.showAnnotations }"
                data-ng-click="viewer.toggleAnnotations()"></button>
        <button class="viewer-button viewer-icon-info-outline" data-ng-class="{ 'is-active': viewer.viewer.info.isOpen }"
                data-ng-click="viewer.viewer.info.isOpen = !viewer.viewer.info.isOpen "></button>
        <a data-ng-href="{{ viewer.getModulePath() }}" target="_blank" title="open module in new window"
           class="viewer-link viewer-icon-launch"></a>
    </nav>
    <div class="viewer-size-controls">
        <button class="viewer-button"
                data-ng-repeat="breakpoint in ::viewer.breakpoints"
                data-ng-class="{ 'is-active': (viewer.width == breakpoint.width) }"
                data-ng-click="viewer.setWidth(breakpoint.width)"
                >{{ ::breakpoint.name }}</button>
        <button class="viewer-button"
                data-ng-class="{ 'is-active': viewer.autoWidth }"
                data-ng-click="viewer.toggleAutoWidth()">FULL</button>
		<div class="viewer-width-input-wrapper">
			<input	id="viewer-width" class="viewer-width-input" type="number" min="240" step="10" required="true"
					  data-ng-model="viewer.width"
					  data-ng-readonly="viewer.autoWidth">
		</div>
    </div>

</header>



<main class="viewer-content">
    <article class="viewer-info"
             data-ng-show="viewer.viewer.info.isOpen"
             data-ng-style="{ 'height': (viewer.height/(viewer.info.isCompact+1)) +'px' }">
        <button class="viewer-button" data-ng-click="viewer.info.isCompact = !viewer.info.isCompact">
            <span class="" data-ng-if="!viewer.info.isCompact">-</span>
            <span class="" data-ng-if="viewer.info.isCompact">+</span>
        </button>
        <button class="viewer-button viewer-info-close" data-ng-click="viewer.viewer.info.isOpen = false">x</button>
        <h1 data-ng-if="!viewer.module.info.readme">{{ viewer.module.name }} {{ viewer.module.type }}</h1>
        <div data-ng-bind-html="viewer.module.info.readme"></div>
        <nav>
            <ul class="viewer-tabs">
                <li data-ng-repeat="lang in viewer.languages"
                    data-ng-if="viewer.module.info[lang]">
                    <button class="viewer-button"
                            data-ng-class="{ 'is-active': viewer.module.lang == lang }"
                            data-ng-click="viewer.setModuleLang(lang)">
                        {{ lang }}
                    </button>
                </li>
            </ul>
        </nav>
        <section data-ng-repeat="lang in viewer.languages"
                 data-ng-if="viewer.module.lang == lang">
            <h2 class="a11y-sr-only">{{ lang }}</h2>
            <div data-ng-bind-html="viewer.module.info[lang]"></div>
        </section>
    </article>
    <iframe class="viewer-frame"
            sandbox="allow-same-origin allow-scripts"
            data-viewer-frame
            data-ng-src="{{ viewer.getModulePath() }}"
            data-ng-attr-width="{{ viewer.width }}"
            data-ng-attr-height="{{ viewer.height }}"
            ></iframe>
</main>


<script src="https://code.angularjs.org/1.3.2/angular.min.js"></script>
<script src="https://code.angularjs.org/1.3.2/angular-sanitize.min.js"></script>
<script>
    angular.module('config',[])
        .constant('ROOT_PATH', '')
        .constant('MODULES', [
            
            
                {
    "id": "components/app-core-styles",
    "name": "app-core-styles",
    "path": "components/app-core-styles/app-core-styles-preview.html",
    "type": "component"
},
            
                {
    "id": "components/app-footer",
    "name": "app-footer",
    "path": "components/app-footer/app-footer-preview.html",
    "type": "component"
},
            
                {
    "id": "components/app-header",
    "name": "app-header",
    "path": "components/app-header/app-header-preview.html",
    "type": "component"
},
            
                {
    "id": "components/app-logo",
    "name": "app-logo",
    "path": "components/app-logo/app-logo-preview.html",
    "type": "component"
},
            
                {
    "id": "components/fixed-ratio",
    "name": "fixed-ratio",
    "path": "components/fixed-ratio/fixed-ratio-preview.html",
    "type": "component"
},
            
                {
    "id": "components/search-menu",
    "name": "search-menu",
    "path": "components/search-menu/search-menu-preview.html",
    "type": "component"
},
            
                {
    "id": "components/social-share",
    "name": "social-share",
    "path": "components/social-share/social-share-preview.html",
    "type": "component"
},
            
            
                {
    "id": "views/home",
    "name": "home",
    "path": "views/home/home.html",
    "type": "view"
},
            
                {
    "id": "views/login",
    "name": "login",
    "path": "views/login/login.html",
    "type": "view"
},
            
                {
    "id": "views/search",
    "name": "search",
    "path": "views/search/search.html",
    "type": "view"
},
            
            {
                id: 'app/index',
                name: 'index',
                path: 'views/_guide-index/guide-index.html',
                type: 'app'
            },
            {
                id: 'app/style-guide',
                name: 'style-guide',
                path: 'views/_style-guide/style-guide.html',
                type: 'app'
            }
        ]);
</script>
<script>angular.module('app', ['config', 'ngSanitize'])
/**
 * Viewer Controller
 * Controls dimensions (width & height) of the viewer so user can preview a component in
 * different viewport (frame) sizes. Also adds shortcuts for predefined breakpoints (XS, S, M, L)
 * and enables user to toggle additional info of the active (selected) component.
 */
	.controller('ViewerController', function($http, $scope, $timeout, $window, ROOT_PATH, MODULES){
		'use strict';
		/* jshint validthis: true */
		var viewer = this;
		viewer.autoWidth = true;
		viewer.breakpoints = [
			{ name: 'XS', width: 320, icon: 'mobile' },
			{ name: 'S', width: 520, icon: 'tablet' },
			{ name: 'M', width: 620, icon: 'laptop' },
			{ name: 'L', width: 960, icon: 'desktop' }
		];
		viewer.frame = document.querySelector('[data-viewer-frame]');
		viewer.getModulePath = getModulePath;
		viewer.header = document.querySelector('[data-viewer-header]');
		viewer.height = setAutoHeight();
		viewer.info = { isCompact: true };
		viewer.languages = ['template', 'html', 'less', 'css', 'js'];
		viewer.modules = {};
		viewer.setWidth = setWidth;
		viewer.showInfo = false;
		viewer.toggleAnnotations = toggleAnnotations;
		viewer.toggleAutoWidth = toggleAutoWidth;
		viewer.width = setAutoWidth();
		viewer.rootPath = ROOT_PATH;
		viewer.setModuleLang = setModuleLang;
		viewer.showAnnotations = false;

		MODULES.forEach(function(module){
			viewer.modules[module.id] = module;
		});
		setDefaultModule();
		$timeout(function(){ setAutoHeight(); }, 0);
		angular.element($window).bind('resize', setDimensions);

		window.addEventListener('message', function(event){
			var message = event.data;
			if(viewer.modules.hasOwnProperty(message.moduleId)){
				viewer.module = viewer.modules[message.moduleId];
				$scope.$apply();
			}
		}, false);

		function getModuleInfo() {
			var module = viewer.module;
			if(!module.info){
				module.info = {};
				// @fix use a proper way to ge the info file url:
				var infoFileUrl = getModulePath().replace('-preview', '').replace('.html', '-info.json');
				$http.get(infoFileUrl)
					.then(function(response){
						module.info = response.data;
					});
			}
		}

		function getModulePath() {
			if(!viewer.module || !viewer.module.path){ return ''; }
			return ROOT_PATH + viewer.module.path;
		}

		/**
		 * Sets viewer's height to the full available height (window minus offset by header).
		 * @returns {Number} height of the viewer frame in pixels (but excluding unit)
		 */
		function setAutoHeight() {
			var frameOffset = viewer.frame.getBoundingClientRect().top;
			viewer.height = window.innerHeight - frameOffset;
			return viewer.height;
		}

		/**
		 * Sets viewer's width to the full available (window) width.
		 * @returns {Number} width of the viewer frame in pixels (but excluding unit)
		 */
		function setAutoWidth() {
			viewer.width = window.innerWidth;
			return viewer.width;
		}

		/**
		 * Sets viewer to component to the one named in the location hash
		 * or otherwise defaults to first one in list of components.
		 * @returns {Object} component
		 */
		function setDefaultModule() {
			var id = window.location.hash.substr(1);
			var activeModule;
			if(viewer.modules.hasOwnProperty(id)){
				activeModule = viewer.modules[id];
			} else {
				var firstKey = Object.keys(viewer.modules)[0];
				activeModule = viewer.modules[firstKey];
			}
			$timeout(function(){
				viewer.module = activeModule;
			}, 0);
			return viewer.module;
		}

		/**
		 * Set height & width of the viewer according to settings.
		 * @returns { {height: number, width: number} } dimensions in pixels (but excluding units)
		 */
		function setDimensions() {
			if(viewer.autoWidth){
				setAutoWidth();
			}
			setAutoHeight();
			$scope.$apply();
			return {
				height  : viewer.height,
				width   : viewer.width
			};
		}

		function setModuleLang(lang) {
			if(viewer.module){
				viewer.module.lang = lang;
			}
		}

		/**
		 * Set viewer to given width (in pixels).
		 * @param {Number} width    desired width in pixels.
		 * @returns {Number} width  in pixels (but excluding unit)
		 */
		function setWidth(width) {
			viewer.autoWidth = false;
			viewer.width = width;
			return width;
		}

		/**
		 * Send message to iframe content to toggle annotations.
		 */
		function toggleAnnotations() {
			viewer.showAnnotations = !viewer.showAnnotations;
			viewer.frame.contentWindow.postMessage({
				fromViewer: true,
				showAnnotations: viewer.showAnnotations
			}, '*');
		}

		/**
		 * Turns auto width property on/off. When turned on, width is also changed directly.
		 * @returns {Boolean} true if auto width is on
		 */
		function toggleAutoWidth() {
			viewer.autoWidth = !viewer.autoWidth;
			if(viewer.autoWidth){
				setAutoWidth();
			}
			return viewer.autoWidth;
		}

		$scope.$watch(function() {
			if(!viewer.module) { return false; }
			return viewer.module.id;
		}, function(id) {
			if(id) {
				window.location.hash = id;
				viewer.showAnnotations = false;
				viewer.info.isOpen = false;
				viewer.module.lang = viewer.languages[0];
				getModuleInfo();
			}
		});
	});</script>
</body>
</html>